[TOC]



# 存储系统概述

## 存储器分类

1.按存储介质分类  
	半导体器件：内存、Flash  
	磁性材料：磁盘、磁带  
    光介质材料：光盘

2.存取方式分类   
	随机存取存储器(RAM)  
	顺序存取存储器(SAM)   
	直接存取存储器(DAM)  
	只读存储器(ROM)

3.按应用功能分类

​	主存储器  
​	辅助存储器  
​	高速缓冲存储器  
​	控制存储器

4.控制存储器

## 存储区的主要技术指标

1.存储容量

2.存取速度  
	存取时间  
	存取周期 

3.传输速度

## 层次结构存储系统

**Cache-主存-辅存**

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\2_1.png" alt="image-20200820165649342" style="zoom: 50%;" />

1.**Cache-主存** 存储层次

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\2_2.png" alt="image-20200820170019425" style="zoom: 67%;" />

2.**主存-辅存** 存储层次

![image-20200820170053655](C:\Users\GaoWei\Desktop\新建文件夹\图片\2_3.png)

------















# 半导体存储技术

## 静态存储器

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\2_4.png" alt="image-20200820170357631" style="zoom:67%;" />

## 动态存储器

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\2_5.png" alt="image-20200820171732891" style="zoom: 50%;" />

**DRAM芯片刷新方式**    
刷新周期：同一存储元连续两次刷新的最大间隔  
刷新方式：每个刷新周期内，循环进行所有行的行刷新

1.集中式刷新：各行的刷新操作集中在一段时间内连续进行。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\2_6.png" alt="image-20200820172747184" style="zoom: 67%;" />

2.分散刷新：各行的刷新操作分撒在各个存取周期中进行。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\2_7.png" alt="image-20200820173111100" style="zoom:67%;" />

3.异步刷新：各行的刷新操作均匀分散在整个刷新周期中进行。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\2_8" alt="image-20200820173215200" style="zoom:67%;" />

**DRAM的写周期时序**

**DRAM的读周期时序**

**SRAM和DRAM比较**

|                |     SRAM     |          DRAM          |
| :------------: | :----------: | :--------------------: |
|    存储单元    |    触发器    |          电容          |
|      读出      | 非破坏性读出 | 破坏性读出（需要刷新） |
|      刷新      |  不需要刷新  |        需要刷新        |
|   送行列地址   |    同时送    |        分两次送        |
|    运行速度    |      块      |           慢           |
|     集成度     |      低      |           高           |
| 发热量（功耗） |      大      |           小           |
|    存储成本    |      高      |           低           |
|    主要用途    |   高速缓存   |        主机内存        |

## 半导体只读存储器

ROM具有非易失性，采用随机访问方式。

1.掩膜式只读存储器MROM

2.一次可编程制度存储器PROM

3.可擦除可编程只读存储器EPROM

4.电擦除可编程ROM

5.闪速存储器（Flash）：U盘

------















# 主存储器

主存容量＝主存单元长度×主存单元个数

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_9.png" alt="image-20200821143027780" style="zoom:67%;" />

只读区域：ROM芯片  
读写区域：SRAM或DRAM芯片

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_10.png" alt="image-20200821143553596" style="zoom: 67%;" />

## 主存储器的逻辑设计

1.位扩展法（位并联法）：将多个存储器芯片并联起来增加存储字长、扩展后存储模块的字数与个芯片字数相同，存储字长为各芯片存储字长的和。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_11.png" alt="image-20200821144536435" style="zoom:50%;" />

2.字扩展法（地址串联扩展）：将多个存储器芯片串联起来增加存储字数，扩展后存储器的字长与各个芯片字长相同，存储字数为各个芯片存储字数的和。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_12.png" alt="image-20200821145020674" style="zoom: 50%;" />

3.字位扩展法：位扩展和字扩展的组合，扩展后存储器的字数及字长都有所增加。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_13.png" alt="image-20200821145757623" style="zoom:50%;" />

## 主存储器与CPU的连接

CPU的存储器接口包含**地址**、**数据**、**控制/状态引脚**

主存与CPU的连接线：**数据线**、**地址线**、**控制线（读写线和片选线）**

1.数据线的连接：决定一次可访问数据的位数  
	主存数据线数=CPU数据引脚线  
	主存数据线与CPU数据引脚一一连接

2.地址线的连接：决定主存的可寻址空间  
	**CPU地址引脚低位**与**主存地址线**一一对应连接  
	**CPU地址引脚高位**与**主存片选线**按一定逻辑连接

3.控制线的连接  
	WE：读/写命令线  
	CS：片选线

## 提高访存速度的技术

**增强DRAM**  
1.FPM DRAM  
2.SDRAM  
3.DDR SDRAM 

**多模块存储器**  
存储器由多个容量相同的存储体组成，每个存储体都有独立的存储阵列、读写电路。

多模块存储器的存储单元有**顺序编址**和**交叉编址**。  
顺序编址（连续编址）：同一存储体的存储单元地址连续。并行访问毫无意义。  
交叉编址（模m编址）：同意存储体的存储单元地址都相差m（m为存储体数）。并行访问可以提高存取速度。  

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_14.png" alt="image-20200821161353852" style="zoom: 67%;" />

工作方式：串行方式、并行方式、交叉方式  
1.串行工作方式——适用于顺序编址方式   
	同一时刻只有一个存储体工作。  
	访存性能无任何提高，便于扩展内存容量。

2.并行工作方式——适用于交叉编址方式  
	同一时刻所有存储体可同时工作。  
	一次访问多个存储字。  

3.交叉工作方式——适用于交叉编址方式  
	多次访问地址连续

**双端口存储器**

在一个存储器中提供两组独立的读写控制电路及I/O电路，因而可以支持对两个数据的同时访问，从而提高了存储器宽带。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_15.png" alt="image-20200821165808917" style="zoom:50%;" />

------

















# 高速缓冲器

## Cache 的基本原理

Cache 是主存的快速缓冲器。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_16.png" alt="image-20200824142506896" style="zoom:67%;" />

**命中率：**
$$
H_C=H_C/(N_C+N_m)
$$
**平均访问时间**：
$$
T_A =H \times T_c + (1-H) \times (T_c+T_m) = T_c + (1-H) \times T_m = T_{命中} + (1-H) \times T_{缺失}
$$
**Cache 的存储空间管理**  
	Cache-主存之间的信息交换单位为块，块由多个相邻的存储字（主存字）组成，大小固定。  
	主存中的区域称为主存块，Cache中的区域称为缓冲块。  
	通常将存放缓存块和相应管理信息的存储空间称为行或槽。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_17.png" alt="image-20200824150725784" style="zoom:50%;" />

Cache 信息的组织：每行存放一个数据块

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_18.png" alt="image-20200824151129663" style="zoom:50%;" />

**Cache 的工作流程**  
	①地址变换	②访问数据	③保持一致性

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_19.png" alt="image-20200824151827323" style="zoom:50%;" />

映射规则：确定主存块可以放到哪些 Cache 行中的方法。  
替换算法：在查找范围内找出牺牲行的方法。  
写策略：数据写回主存的时机及方法，分为**立即写**和**稍后写**。

## Cache 的地址映射

1.直接映射：一个主存块只能存放到一个Cache中，候选行数只有1行。  
映射函数为：
$$
j=i \mod G
$$
<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_20.png" alt="image-20200824154517534" style="zoom:50%;" />

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_21.png" alt="image-20200824155010796" style="zoom:50%;" />

2.全相联映射：一个主存块可以存放到Cache任意一行中，候选行为Cache所有行。  
映射函数为：**随机函数**

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_22.png" alt="image-20200824160024027" style="zoom:50%;" />

3.组相连映射：将Cache的行划分成若干个组，每个组所含行数为n，一个内存块可以存放到一个Cache组的任意一行中。  
映射函数为：
$$
j=i \mod G/n
$$
<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_23.png" alt="image-20200824162012723" style="zoom:50%;" />

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_24.png" alt="image-20200824162047450" style="zoom:50%;" />

## Cache 的替换算法

当Cache需要调入内存块，但没有空闲行时，从候选行中找出牺牲块。  

1.随机算法(RAND)：在候选行中随机选择一个牺牲块。  

2.先进先出算法(FIFO)：选择最早调入的块作为牺牲块。

3.最近最少使用算法(LRU)：选择近期最少使用的块作为牺牲块。

## Cache 的写策略

Cache 将 CPU 所写数据写回主存的时机及方法。

1.全写法（写直达法）  
	写命中时，将数据写入Cache，同时写入主存；  
	写缺失时，通常直接将数据写入主存，而不将目标主存块调入Cache。

写缺失时，通常采用不按写分配法：直接将数据写入主存，而不将目标块调入Cache。

**Cache与主存保持了一致性，替换时只需将牺牲行抛弃即可，而无须将其写入主存。**

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_25.png" alt="image-20200824175413014" style="zoom:50%;" />

2.写回法（回写法）  
	写命中时，直将数据写入Cache，不写入主存；  
	写缺失时，先将目标主存块调入Cache。

写缺失时，通常采用按写分配法：先将目标块调入 Cache，再将数据写入该 Cache 行。

**每个Cache行的管理信息中，需要设置一个修改位（脏位），表明该行是否被修改过。**  
**Cache处理写操作时，需要将脏位置为1；在替换处理时，通过判断脏位确定是否将该缓存块写入主存。**

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_26.png" alt="image-20200824175918848" style="zoom:50%;" />













# 虚拟存储器

虚拟存储器(VM)是一个以透明方式为程序提供的、比主存空间大得多的存储空间。  
	虚拟地址：虚拟存储器的存储单元。  
	物理地址：主存地址。  

基本思想：借助辅存来扩充主存的存储空间，并能够按虚拟地址来进行访问。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_27.png" alt="image-20200825161956253" style="zoom: 67%;" />

**工作过程：**

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_28.png" alt="image-20200825162316293" style="zoom:50%;" />

## 虚拟存储器的存储管理

1.段式虚拟存储器  
程序由多个段组成，段的类型有多种，如**代码段**、**数据段**、**堆栈段**等，同一类型的段可以有多个，每个段的大小可以不同。  
按程序逻辑结构将虚存空间划分为若干个段，段大小为程序中段的大小，主存空间以段为单位分配给虚存使用，虚拟地址由段号及段内地址组成。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_29.png" alt="image-20200825163207243" style="zoom:50%;" />



2.段页式虚拟存储器  
先按程序逻辑结构将虚存空间分段，再对每个段按页大小分页，主存仅按页大小分页，主存以页为单位分配给虚存使用。  

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_31.png" alt="image-20200825164303315" style="zoom:50%;" />

3.页式虚拟存储器  
页是大小固定的存储块。  
将虚存空间及主存空间按页大小划分成若干逻辑页和物理页，主存以页为单位分配给虚存使用，虚存地址由虚拟页号及页内地址组成，主存地址由物理页号及页内地址组成。

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_30.png" alt="image-20200825163807130" style="zoom:50%;" />

**实现方法**：  
① 缓存的管理  
虚拟存储器中，主存是辅存的缓冲存储器。  
虚存 - 主存 的映射只能采用**全相联映射方式**。为了减少命中时间，主存的写策略采用**写回法**。

② 页表的组织  
	装入位、物理页号、访问位、修改位、读/写位、禁止缓存位、···

<img src="C:\Users\GaoWei\Desktop\新建文件夹\图片\3_32.png" alt="image-20200825170052058" style="zoom:50%;" />

③ 快表(TLB)  
TLB是一个小容量的、用虚拟地址访问的高速缓存，每个条目存放由一个页表项组成的块。

